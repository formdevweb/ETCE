<!DOCTYPE html>
<html lang="fr" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ETCE Ingénierie - Blog</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link href="../src/output.css" rel="stylesheet" />
    <script src="../script.js" defer></script>
  </head>
  <body
    class="bg-gray-100 text-gray-900 font-montserrat min-h-full flex flex-col"
  >
    <!-- Header -->
    <header class="bg-blue-900 text-white p-4">
      <div class="container mx-auto flex justify-between items-center">
        <!-- Logo -->
        <div class="flex items-center">
          <img
            src="./assets/Accueil/logo1.webp"
            alt="ETCE Ingénierie"
            class="w-20 h-20 scale-x-40 scale-y-20 transform rounded-full"
          />
          <span class="ml-2 text-xl font-bold">Etce Ingénierie</span>
        </div>
        <!-- Menu Burger (visible sur mobile) -->
        <button id="menu-toggle" class="md:hidden focus:outline-none">
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            ></path>
          </svg>
        </button>
        <!-- Navigation (cachée sur mobile, visible sur desktop) -->
        <nav id="menu" class="hidden md:flex space-x-6">
          <a
            href="index.html"
            class="border-2 border-yellow-400 rounded-xl hover:bg-gray-800 hover:text-yellow-400 px-4 py-2 mx-2 transition-all duration-400"
            >Accueil</a
          >
          <a
            href="services.html"
            class="border-2 border-yellow-400 rounded-xl hover:bg-gray-800 hover:text-yellow-400 px-4 py-2 mx-2 transition-all duration-300"
            >Services</a
          >
          <a
            href="about.html"
            class="border-2 border-yellow-400 rounded-xl hover:bg-gray-800 hover:text-yellow-400 px-4 py-2 mx-2 transition-all duration-300"
            >À propos</a
          >
          <a
            href="blog.html"
            class="border-2 border-yellow-400 rounded-xl hover:bg-gray-800 hover:text-yellow-400 px-4 py-2 mx-2 transition-all duration-300"
            >Blog</a
          >
          <a
            href="contact.html"
            class="border-2 border-yellow-400 rounded-xl hover:bg-gray-800 hover:text-yellow-400 px-4 py-2 mx-2 transition-all duration-300"
            >Contact</a
          >
        </nav>
      </div>
      <!-- Menu Mobile (caché par défaut) -->
      <div id="mobile-menu" class="md:hidden hidden mt-4">
        <a href="index.html" class="block py-2 hover:text-yellow-400"
          >Accueil</a
        >
        <a href="services.html" class="block py-2 hover:text-yellow-400"
          >Services</a
        >
        <a href="about.html" class="block py-2 hover:text-yellow-400"
          >À propos</a
        >
        <a href="blog.html" class="block py-2 hover:text-yellow-400">Blog</a>
        <a href="contact.html" class="block py-2 hover:text-yellow-400"
          >Contact</a
        >
      </div>
    </header>

    <!-- Hero Section -->
    <section
      class="bg-gradient-to-r from-blue-900 to-blue-700 text-white py-20"
    >
      <div class="container mx-auto text-center px-4">
        <h1 class="text-5xl font-bold mb-6">Blog ETCE Ingénierie</h1>
        <p class="text-xl mb-10 max-w-2xl mx-auto">
          Découvrez nos dernières actualités, innovations techniques et projets
          réalisés
        </p>
        <button
          id="addArticleBtn"
          class="bg-yellow-400 text-blue-900 px-8 py-4 rounded-lg font-bold hover:bg-yellow-500 transform hover:scale-105 transition-all duration-300 shadow-lg"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 inline-block mr-2"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4v16m8-8H4"
            />
          </svg>
          Ajouter un article
        </button>
      </div>
    </section>

    <!-- Articles Section -->
    <section class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <!-- Filtres et recherche -->
        <div
          class="mb-12 flex flex-col md:flex-row justify-between items-center"
        >
          <h2 class="text-3xl font-bold text-gray-800 mb-4 md:mb-0">
            Nos Articles
          </h2>
          <div class="flex space-x-4">
            <input
              type="text"
              id="searchArticle"
              placeholder="Rechercher un article..."
              class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-400"
            />
          </div>
        </div>

        <div
          id="articlesList"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
        >
          <!-- Les articles seront injectés ici dynamiquement -->
        </div>
      </div>
    </section>

    <!-- Modal pour Ajouter/Modifier un Article -->
    <div
      id="articleModal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
    >
      <div class="bg-white p-8 rounded-lg w-full max-w-2xl mx-4">
        <div class="flex justify-between items-center mb-6">
          <h2 id="modalTitle" class="text-2xl font-bold text-gray-800">
            Ajouter un Article
          </h2>
          <button id="cancelBtn" class="text-gray-500 hover:text-gray-700">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <form id="articleForm" class="space-y-6">
          <div>
            <label class="block text-gray-700 mb-2 font-semibold">Titre</label>
            <input
              type="text"
              id="articleTitle"
              class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400"
              required
            />
          </div>
          <div>
            <label class="block text-gray-700 mb-2 font-semibold"
              >Image URL</label
            >
            <input
              type="url"
              id="articleImage"
              class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400"
              required
            />
          </div>
          <div>
            <label class="block text-gray-700 mb-2 font-semibold"
              >Contenu</label
            >
            <textarea
              id="articleContent"
              class="w-full border border-gray-300 rounded-lg p-3 h-40 focus:outline-none focus:ring-2 focus:ring-yellow-400"
              required
            ></textarea>
          </div>
          <div class="flex justify-end space-x-4 pt-4">
            <button
              type="submit"
              class="px-6 py-3 bg-yellow-400 text-blue-900 rounded-lg hover:bg-yellow-500 transition-all duration-300 font-bold shadow-md hover:shadow-lg transform hover:scale-105"
            >
              Enregistrer
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8 mt-auto">
      <div class="container mx-auto text-center">
        <p>&copy; 2023 ETCE Ingénierie. Tous droits réservés.</p>
        <div class="mt-4 space-x-4">
          <a href="#" class="text-yellow-400 hover:text-yellow-500">Facebook</a>
          <a href="#" class="text-yellow-400 hover:text-yellow-500">LinkedIn</a>
          <a href="#" class="text-yellow-400 hover:text-yellow-500">Twitter</a>
        </div>
      </div>
    </footer>

    <script>
      // Gestion du Blog
      document.addEventListener("DOMContentLoaded", () => {
        const addArticleBtn = document.getElementById("addArticleBtn");
        const articleModal = document.getElementById("articleModal");
        const articleForm = document.getElementById("articleForm");
        const cancelBtn = document.getElementById("cancelBtn");
        const articlesList = document.getElementById("articlesList");

        let articles = [];
        let editingArticleId = null;

        // Charger les articles au démarrage
        loadArticles();

        // Ouvrir le modal pour ajouter un article
        if (addArticleBtn) {
          addArticleBtn.addEventListener("click", () => {
            editingArticleId = null;
            document.getElementById("modalTitle").textContent =
              "Ajouter un Article";
            articleForm.reset();
            articleModal.classList.remove("hidden");
          });
        }

        // Fermer le modal
        if (cancelBtn) {
          cancelBtn.addEventListener("click", () => {
            articleModal.classList.add("hidden");
          });
        }

        // Gérer la soumission du formulaire
        if (articleForm) {
          articleForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const articleData = {
              title: document.getElementById("articleTitle").value,
              imageUrl: document.getElementById("articleImage").value,
              content: document.getElementById("articleContent").value,
              date: new Date().toISOString(),
            };

            try {
              if (editingArticleId) {
                await updateArticle(editingArticleId, articleData);
              } else {
                await createArticle(articleData);
              }

              articleModal.classList.add("hidden");
              loadArticles();
            } catch (error) {
              console.error("Erreur:", error);
              alert(
                "Une erreur est survenue lors de l'enregistrement de l'article."
              );
            }
          });
        }

        // Fonctions pour gérer les articles
        async function loadArticles() {
          try {
            const response = await fetch("http://localhost:3000/articles");
            articles = await response.json();
            displayArticles();
          } catch (error) {
            console.error("Erreur lors du chargement des articles:", error);
          }
        }

        async function createArticle(articleData) {
          const response = await fetch("http://localhost:3000/articles", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(articleData),
          });
          return response.json();
        }

        async function updateArticle(id, articleData) {
          const response = await fetch(`http://localhost:3000/articles/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(articleData),
          });
          return response.json();
        }

        async function deleteArticle(id) {
          const response = await fetch(`http://localhost:3000/articles/${id}`, {
            method: "DELETE",
          });
          return response.json();
        }

        function displayArticles() {
          if (!articlesList) return;

          articlesList.innerHTML = "";
          articles.forEach((article) => {
            const date = new Date(article.date).toLocaleDateString("fr-FR");
            const articleElement = document.createElement("div");
            articleElement.className =
              "bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-all duration-300 border border-gray-100";
            articleElement.innerHTML = `
            <div class="relative">
              <img src="${article.imageUrl}" alt="${article.title}" class="w-full h-48 object-cover">
              <div class="absolute top-0 right-0 m-4 bg-yellow-400 text-blue-900 px-3 py-1 rounded-full text-sm font-semibold">
                ${date}
              </div>
            </div>
            <div class="p-6">
              <h3 class="text-xl font-bold mb-3 text-gray-800">${article.title}</h3>
              <p class="text-gray-600 mb-4 line-clamp-3">${article.content}</p>
              <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                <button onclick="editArticle(${article.id})" class="flex items-center px-4 py-2 bg-yellow-400 text-blue-900 rounded-lg hover:bg-yellow-500 transition-colors font-semibold">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Modifier
                </button>
                <button onclick="deleteArticle(${article.id})" class="flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                  Supprimer
                </button>
              </div>
            </div>
          `;
            articlesList.appendChild(articleElement);
          });
        }

        // Fonctions globales pour l'édition et la suppression
        window.editArticle = async (id) => {
          const article = articles.find((a) => a.id === id);
          if (!article) return;

          editingArticleId = id;
          document.getElementById("modalTitle").textContent =
            "Modifier l'Article";
          document.getElementById("articleTitle").value = article.title;
          document.getElementById("articleImage").value = article.imageUrl;
          document.getElementById("articleContent").value = article.content;
          articleModal.classList.remove("hidden");
        };

        window.deleteArticle = async (id) => {
          if (confirm("Êtes-vous sûr de vouloir supprimer cet article ?")) {
            try {
              await deleteArticle(id);
              loadArticles();
            } catch (error) {
              console.error("Erreur lors de la suppression:", error);
              alert(
                "Une erreur est survenue lors de la suppression de l'article."
              );
            }
          }
        };

        // Ajout de la fonction de recherche
        const searchInput = document.getElementById("searchArticle");
        if (searchInput) {
          searchInput.addEventListener("input", (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredArticles = articles.filter(
              (article) =>
                article.title.toLowerCase().includes(searchTerm) ||
                article.content.toLowerCase().includes(searchTerm)
            );

            articlesList.innerHTML = "";
            if (filteredArticles.length === 0) {
              articlesList.innerHTML = `
                <div class="col-span-full text-center py-8 text-gray-500">
                  Aucun article ne correspond à votre recherche.
                </div>
              `;
            } else {
              filteredArticles.forEach((article) => {
                // Réutiliser le même code de rendu que dans displayArticles
                const date = new Date(article.date).toLocaleDateString("fr-FR");
                const articleElement = document.createElement("div");
                articleElement.className =
                  "bg-white rounded-xl shadow-lg overflow-hidden transform hover:scale-105 transition-all duration-300 border border-gray-100";
                articleElement.innerHTML = `
                <div class="relative">
                  <img src="${article.imageUrl}" alt="${article.title}" class="w-full h-48 object-cover">
                  <div class="absolute top-0 right-0 m-4 bg-yellow-400 text-blue-900 px-3 py-1 rounded-full text-sm font-semibold">
                    ${date}
                  </div>
                </div>
                <div class="p-6">
                  <h3 class="text-xl font-bold mb-3 text-gray-800">${article.title}</h3>
                  <p class="text-gray-600 mb-4 line-clamp-3">${article.content}</p>
                  <div class="flex justify-end space-x-3 pt-4 border-t border-gray-100">
                    <button onclick="editArticle(${article.id})" class="flex items-center px-4 py-2 bg-yellow-400 text-blue-900 rounded-lg hover:bg-yellow-500 transition-colors font-semibold">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                      </svg>
                      Modifier
                    </button>
                    <button onclick="deleteArticle(${article.id})" class="flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                      Supprimer
                    </button>
                  </div>
                </div>
              `;
                articlesList.appendChild(articleElement);
              });
            }
          });
        }
      });
    </script>
  </body>
</html>
